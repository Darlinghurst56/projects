# Home Dashboard - Developer Onboarding Guide

**PROJECT: House AI - Family Home Page | SUBPROJECT: Unified Dashboard System**

## 🚀 Quick Start (5 Minutes)

### Prerequisites
- Node.js 16+ and npm 8+
- Git access to repository
- Network access to external services (192.168.1.74)

### Instant Setup
```bash
# 1. Install dependencies
npm install

# 2. Set up environment
cp .env.example .env
# Edit .env with your configuration

# 3. Start development
npm run dev
```

**Access Points:**
- Frontend: http://localhost:3001
- Backend API: http://localhost:3000/api
- Health Check: http://localhost:3000/health

## 📋 Project Overview

### What is Home Dashboard?
A unified family dashboard that merges three separate systems:
1. **DNS Monitoring** - Real-time DNS status and analytics
2. **Google Services** - Calendar, Gmail, Drive integration
3. **AI Assistant** - Ollama-powered chat interface

### Technology Stack
- **Frontend**: React 18, Vite, Styled Components, Socket.IO Client
- **Backend**: Node.js, Express, Socket.IO, JWT Authentication
- **External Services**: Google APIs, n8n workflows, Ollama AI
- **Database**: In-memory (production would use PostgreSQL/MongoDB)

### Architecture Overview
```
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   React Client  │    │  Express API    │    │ External Services│
│  (Port 3001)    │◄──►│  (Port 3000)    │◄──►│ n8n, Ollama     │
│                 │    │                 │    │ Google APIs     │
└─────────────────┘    └─────────────────┘    └─────────────────┘
```

## 🏗️ Development Environment Setup

### 1. Dependencies Installation
```bash
# Install all dependencies
npm install

# Verify critical packages
npm list | grep -E "(react|express|socket\.io|googleapis)"
```

### 2. Environment Configuration
```bash
# Copy and edit environment file
cp .env.example .env

# Required variables:
# - GOOGLE_CLIENT_ID, GOOGLE_CLIENT_SECRET
# - JWT_SECRET (auto-generated by setup script)
# - N8N_URL=http://192.168.1.74:5678
# - OLLAMA_URL=http://192.168.1.74:11434
```

### 3. External Services Setup
```bash
# Check service connectivity
curl http://192.168.1.74:5678/healthz  # n8n
curl http://192.168.1.74:11434/api/tags # Ollama

# Google API Setup:
# 1. Visit https://console.cloud.google.com/apis/credentials
# 2. Create OAuth 2.0 credentials
# 3. Add redirect URI: http://localhost:3000/auth/google/callback
```

### 4. Development Scripts
```bash
# Start both frontend and backend
npm run dev

# Start only backend
npm run server:dev

# Start only frontend
npm run client:dev

# Build for production
npm run build

# Run tests
npm test
```

## 📁 Project Structure

```
apps/home-dashboard/
├── src/                      # Frontend React application
│   ├── components/           # React components
│   │   ├── auth/            # Authentication components
│   │   ├── dns/             # DNS monitoring widgets
│   │   ├── google/          # Google services widgets
│   │   ├── ai/              # AI chat interface
│   │   └── layout/          # Layout components
│   ├── contexts/            # React contexts (auth, etc.)
│   ├── services/            # API client services
│   ├── config/              # Configuration management
│   └── styles/              # CSS and styling
├── server/                   # Backend Express application
│   ├── routes/              # API route handlers
│   │   ├── auth.js          # Authentication endpoints
│   │   ├── dns.js           # DNS monitoring API
│   │   ├── google.js        # Google services API
│   │   ├── ai.js            # AI chat API
│   │   └── system.js        # System health API
│   ├── middleware/          # Express middleware
│   │   ├── auth.js          # JWT authentication
│   │   ├── errorHandler.js  # Error handling
│   │   └── logger.js        # Request logging
│   ├── integrations/        # External service integrations
│   └── index.js             # Main server file
├── scripts/                 # Utility scripts
│   └── setup.js             # Interactive setup wizard
├── tests/                   # Test files
├── docs/                    # Documentation
└── public/                  # Static assets
```

## 🔐 Authentication System

### Dual Authentication Methods
1. **PIN Authentication** - Family members use 4-digit PIN
2. **Google OAuth** - Full Google services access

### Authentication Flow
```javascript
// PIN Login
POST /api/auth/login-pin
{
  "pin": "1234"
}

// Google OAuth
POST /api/auth/login-google
{
  "token": "google-oauth-token"
}

// Response (both methods)
{
  "token": "jwt-token",
  "user": {
    "id": "user-id",
    "name": "User Name",
    "method": "pin|google"
  }
}
```

### Protected Routes
All API routes except `/auth/*` and `/health` require JWT authentication:
```javascript
// Headers required for protected routes
Authorization: Bearer <jwt-token>
```

## 🛠️ API Reference

### Authentication Endpoints
- `POST /api/auth/login-pin` - PIN-based login
- `POST /api/auth/login-google` - Google OAuth login
- `GET /api/auth/validate` - Token validation
- `POST /api/auth/logout` - Logout
- `POST /api/auth/change-pin` - Change PIN

### DNS Monitoring Endpoints
- `GET /api/dns/status` - Current DNS status
- `GET /api/dns/analytics?timeRange=daily` - DNS analytics
- `GET /api/dns/profile` - DNS configuration
- `PUT /api/dns/profile` - Update DNS settings
- `POST /api/dns/lookup` - Perform DNS lookup

### Google Services Endpoints
- `GET /api/google/calendar/events` - Calendar events
- `POST /api/google/calendar/events` - Create calendar event
- `GET /api/google/gmail/messages` - Gmail messages
- `POST /api/google/gmail/send` - Send email
- `GET /api/google/drive/files` - Drive files
- `POST /api/google/drive/upload` - Upload file

### AI Chat Endpoints
- `POST /api/ai/chat` - Send chat message
- `GET /api/ai/chat/history` - Get chat history
- `DELETE /api/ai/chat/history` - Clear chat history
- `GET /api/ai/status` - AI service status

### System Endpoints
- `GET /api/system/status` - System health check
- `GET /api/system/metrics` - System metrics
- `GET /api/system/config` - Configuration (safe subset)

## 🎨 Component Architecture

### React Component Hierarchy
```
App
├── AuthProvider (Context)
├── Router
    ├── LoginPage
    │   ├── PinLogin
    │   └── GoogleLogin
    └── Dashboard (Protected)
        ├── HeaderNav
        ├── WidgetGrid
        │   ├── DnsStatusWidget
        │   ├── DnsAnalyticsWidget
        │   ├── GoogleCalendarWidget
        │   └── AiChatWidget
        └── SystemStatus
```

### Key Components

#### Dashboard Components
- **Dashboard.jsx** - Main dashboard container
- **WidgetGrid.jsx** - Responsive widget layout
- **HeaderNav.jsx** - Navigation and system status

#### DNS Widgets
- **DnsStatusWidget.jsx** - Real-time DNS status
- **DnsAnalyticsWidget.jsx** - DNS performance charts
- **DnsProfileWidget.jsx** - DNS configuration

#### Google Widgets
- **GoogleCalendarWidget.jsx** - Calendar events display
- **GoogleGmailWidget.jsx** - Gmail messages
- **GoogleDriveWidget.jsx** - Drive files browser

#### AI Components
- **AiChatWidget.jsx** - Chat interface with Ollama

#### Authentication
- **AuthContext.jsx** - Authentication state management
- **ProtectedRoute.jsx** - Route protection
- **LoginPage.jsx** - Unified login interface

## 🔄 State Management

### React Context
```javascript
// AuthContext provides:
{
  user: Object,           // Current user info
  token: String,          // JWT token
  isAuthenticated: Boolean,
  isLoading: Boolean,
  error: String,
  login: Function,        // Login method
  logout: Function,       // Logout method
  clearError: Function    // Clear error state
}
```

### API Service Layer
```javascript
// services/api.js exports:
{
  authApi: {
    loginWithPin,
    loginWithGoogle,
    validateToken,
    logout
  },
  dnsApi: {
    getStatus,
    getAnalytics,
    getProfile,
    updateProfile
  },
  googleApi: {
    getCalendarEvents,
    getGmailMessages,
    getDriveFiles
  },
  aiApi: {
    sendMessage,
    getChatHistory,
    clearHistory
  }
}
```

## 🧪 Testing Strategy

### Test Structure
```
tests/
├── unit/                    # Unit tests
│   ├── components/         # React component tests
│   └── api/               # API endpoint tests
├── integration/           # Integration tests
│   ├── auth-flow.test.js  # Authentication flow
│   └── widget-integration.test.js
└── e2e/                  # End-to-end tests
    └── dashboard-flow.test.js
```

### Running Tests
```bash
# Run all tests
npm test

# Run tests in watch mode
npm run test:watch

# Run tests with coverage
npm run test:coverage

# Run specific test file
npm test -- --testNamePattern="DnsStatusWidget"
```

### Test Examples
```javascript
// Component test example
import { render, screen } from '@testing-library/react';
import { DnsStatusWidget } from '../components/dns/DnsStatusWidget';

test('renders DNS status correctly', () => {
  render(<DnsStatusWidget />);
  expect(screen.getByText('DNS Status')).toBeInTheDocument();
});

// API test example
import { authApi } from '../services/api';

test('PIN login returns valid token', async () => {
  const response = await authApi.loginWithPin('1234');
  expect(response.token).toBeDefined();
  expect(response.user.method).toBe('pin');
});
```

## 🚀 Deployment

### Development Deployment
```bash
# Start development servers
npm run dev

# Frontend: http://localhost:3001
# Backend: http://localhost:3000
```

### Production Deployment
```bash
# Build production assets
npm run build

# Start production server
npm start

# Production runs on single port (3000)
```

### Docker Deployment (Optional)
```dockerfile
FROM node:18-alpine
WORKDIR /app
COPY package*.json ./
RUN npm install
COPY . .
RUN npm run build
EXPOSE 3000
CMD ["npm", "start"]
```

## 🔧 Configuration Management

### Environment Variables
```bash
# Server Configuration
PORT=3000
NODE_ENV=production

# External Services
N8N_URL=http://192.168.1.74:5678
OLLAMA_URL=http://192.168.1.74:11434

# Google API
GOOGLE_CLIENT_ID=your-client-id
GOOGLE_CLIENT_SECRET=your-client-secret

# Authentication
JWT_SECRET=your-secret-key
DEFAULT_PIN=1234

# Feature Flags
FEATURE_DNS_MONITORING=true
FEATURE_GOOGLE_INTEGRATION=true
FEATURE_AI_CHAT=true
```

### Configuration Loading
```javascript
// src/config/index.js
const config = {
  server: {
    port: process.env.PORT || 3000,
    nodeEnv: process.env.NODE_ENV || 'development'
  },
  services: {
    n8n: {
      baseUrl: process.env.N8N_URL || 'http://localhost:5678'
    },
    ollama: {
      baseUrl: process.env.OLLAMA_URL || 'http://localhost:11434'
    }
  },
  features: {
    dnsMonitoring: process.env.FEATURE_DNS_MONITORING === 'true',
    googleIntegration: process.env.FEATURE_GOOGLE_INTEGRATION === 'true',
    aiChat: process.env.FEATURE_AI_CHAT === 'true'
  }
};
```

## 🐛 Debugging Guide

### Common Issues and Solutions

#### 1. Authentication Problems
```bash
# Check JWT token
curl -H "Authorization: Bearer <token>" http://localhost:3000/api/auth/validate

# Reset authentication
rm -rf node_modules/.cache
npm run dev
```

#### 2. External Service Connectivity
```bash
# Test n8n connection
curl http://192.168.1.74:5678/healthz

# Test Ollama connection
curl http://192.168.1.74:11434/api/tags

# Check Google API credentials
echo $GOOGLE_CLIENT_ID
```

#### 3. Build Issues
```bash
# Clear cache and rebuild
rm -rf node_modules dist .vite
npm install
npm run build
```

#### 4. WebSocket Connection Issues
```javascript
// Check WebSocket connection in browser console
const socket = io('http://localhost:3000');
socket.on('connect', () => console.log('Connected'));
socket.on('disconnect', () => console.log('Disconnected'));
```

### Debug Mode
```bash
# Enable debug logging
DEBUG=true npm run dev

# Enable verbose logging
VERBOSE_LOGGING=true npm run dev
```

## 🔍 Code Quality

### Linting and Formatting
```bash
# Run ESLint
npm run lint

# Fix linting issues
npm run lint:fix

# Check TypeScript (if applicable)
npm run typecheck
```

### Code Standards
- **React**: Use functional components with hooks
- **Async/Await**: Prefer over Promises
- **Error Handling**: Always handle errors with try/catch
- **Security**: Validate all inputs, sanitize data
- **Documentation**: Document all public APIs

### Pre-commit Hooks
```bash
# Install pre-commit hooks
npm install --save-dev husky

# Add to package.json
"husky": {
  "hooks": {
    "pre-commit": "npm run lint && npm test"
  }
}
```

## 📚 Learning Resources

### Required Knowledge
- **React 18**: Hooks, Context, Suspense
- **Node.js/Express**: RESTful APIs, middleware
- **JWT Authentication**: Token-based auth
- **WebSockets**: Real-time communication
- **Google APIs**: OAuth, Calendar, Gmail, Drive

### Recommended Reading
- [React Documentation](https://react.dev/)
- [Express.js Guide](https://expressjs.com/)
- [JWT.io](https://jwt.io/)
- [Socket.IO Documentation](https://socket.io/)
- [Google APIs Documentation](https://developers.google.com/)

### Internal Documentation
- `README.md` - Project overview
- `MERGER_COMPLETION_REPORT.md` - System architecture
- `EXTERNAL_CODE_AUDIT.md` - Security and compliance
- `API_DOCUMENTATION.md` - Detailed API reference

## 🆘 Getting Help

### Support Channels
1. **Documentation**: Check all `.md` files in project root
2. **Code Comments**: Look for inline documentation
3. **Logs**: Check console output and log files
4. **Health Checks**: Use `/health` and `/api/system/status`

### Emergency Procedures
```bash
# System recovery
npm run dev -- --reset

# Database reset (development only)
rm -rf data/
npm run dev

# Full reset
rm -rf node_modules dist .vite data/
npm install
npm run dev
```

---

**Welcome to the Home Dashboard project! This unified system represents the merger of three separate dashboard systems into a cohesive, modern application. Follow this guide to get up and running quickly.**

**Last Updated**: 2025-07-16  
**Version**: 1.0.0  
**Next Update**: Add Docker support and production deployment guide