{
  "name": "Google Calendar API Node Configuration", 
  "nodes": [
    {
      "id": "telegram-trigger",
      "name": "Telegram Bot",
      "type": "@n8n/n8n-nodes-base.telegramTrigger",
      "position": [200, 300],
      "parameters": {
        "contentType": "automatic",
        "replyToMessage": false,
        "download": false
      },
      "credentials": {
        "telegramApi": {
          "id": "telegram-bot-credentials",
          "name": "Telegram Bot Credentials"
        }
      }
    },
    {
      "id": "calendar-command-parser",
      "name": "Parse Calendar Command",
      "type": "@n8n/n8n-nodes-base.function",
      "position": [400, 300],
      "parameters": {
        "functionCode": "// Parse /create_event command\nconst text = $input.first().json.message.text || '';\nconst userId = $input.first().json.message.from.id;\n\n// Security validation - authorized users only\nconst authorizedUsers = [123456789]; // Replace with actual user IDs\nif (!authorizedUsers.includes(userId)) {\n  return [{\n    json: {\n      error: 'Unauthorized user',\n      userId: userId,\n      authorized: false\n    }\n  }];\n}\n\n// Parse calendar command format: /create_event title:Meeting date:2025-01-15 time:14:30 duration:60 description:Team meeting\nif (!text.startsWith('/create_event')) {\n  return [{\n    json: {\n      error: 'Invalid command format',\n      expectedFormat: '/create_event title:Meeting date:2025-01-15 time:14:30 duration:60 description:Optional description',\n      authorized: true\n    }\n  }];\n}\n\nconst eventRegex = /title:([^\\s]+(?:\\s+[^\\s]+)*)\\s+date:(\\d{4}-\\d{2}-\\d{2})\\s+time:(\\d{2}:\\d{2})\\s+duration:(\\d+)(?:\\s+description:([\\s\\S]+))?/;\nconst match = text.match(eventRegex);\n\nif (!match) {\n  return [{\n    json: {\n      error: 'Invalid event format',\n      expectedFormat: '/create_event title:Meeting date:2025-01-15 time:14:30 duration:60 description:Optional description',\n      authorized: true\n    }\n  }];\n}\n\nconst title = match[1].trim();\nconst date = match[2];\nconst time = match[3];\nconst duration = parseInt(match[4]);\nconst description = match[5] ? match[5].trim() : '';\n\n// Create start and end datetime\nconst startDateTime = new Date(`${date}T${time}:00`);\nconst endDateTime = new Date(startDateTime.getTime() + (duration * 60000));\n\n// Validate date/time\nif (isNaN(startDateTime.getTime())) {\n  return [{\n    json: {\n      error: 'Invalid date or time format',\n      expectedFormat: 'date:YYYY-MM-DD time:HH:MM',\n      authorized: true\n    }\n  }];\n}\n\nreturn [{\n  json: {\n    title: title,\n    description: description,\n    startDateTime: startDateTime.toISOString(),\n    endDateTime: endDateTime.toISOString(),\n    date: date,\n    time: time,\n    duration: duration,\n    fromUserId: userId,\n    authorized: true,\n    timestamp: new Date().toISOString()\n  }\n}];"
      }
    },
    {
      "id": "calendar-create-event",
      "name": "Google Calendar Create Event",
      "type": "@n8n/n8n-nodes-base.googleCalendar",
      "position": [600, 300],
      "parameters": {
        "operation": "create",
        "calendarId": "primary",
        "title": "={{ $json.title }}",
        "description": "={{ $json.description }}",
        "start": {
          "dateTime": "={{ $json.startDateTime }}",
          "timeZone": "America/New_York"
        },
        "end": {
          "dateTime": "={{ $json.endDateTime }}",
          "timeZone": "America/New_York"
        },
        "sendNotifications": false,
        "maxAttendees": 0
      },
      "credentials": {
        "googleCalendarOAuth2": {
          "id": "google-calendar-oauth2-credentials",
          "name": "Google Calendar OAuth2 Credentials"
        }
      }
    },
    {
      "id": "calendar-success-reply",
      "name": "Calendar Success Reply",
      "type": "@n8n/n8n-nodes-base.telegram",
      "position": [800, 200],
      "parameters": {
        "operation": "sendMessage",
        "chatId": "={{ $('Telegram Bot').first().json.message.chat.id }}",
        "text": "üìÖ Calendar event created successfully!\n\nüìù Title: {{ $('Parse Calendar Command').first().json.title }}\nüìÜ Date: {{ $('Parse Calendar Command').first().json.date }}\nüïí Time: {{ $('Parse Calendar Command').first().json.time }}\n‚è±Ô∏è Duration: {{ $('Parse Calendar Command').first().json.duration }} minutes\nüîó Event ID: {{ $json.id }}\n\n‚úÖ Event added to your Google Calendar!"
      },
      "credentials": {
        "telegramApi": {
          "id": "telegram-bot-credentials",
          "name": "Telegram Bot Credentials"
        }
      }
    },
    {
      "id": "calendar-error-reply",
      "name": "Calendar Error Reply",
      "type": "@n8n/n8n-nodes-base.telegram",
      "position": [800, 400],
      "parameters": {
        "operation": "sendMessage",
        "chatId": "={{ $('Telegram Bot').first().json.message.chat.id }}",
        "text": "‚ùå Calendar event creation failed!\n\nError: {{ $json.error || 'Unknown error occurred' }}\n\nPlease check your command format:\n/create_event title:Meeting date:2025-01-15 time:14:30 duration:60 description:Optional description"
      },
      "credentials": {
        "telegramApi": {
          "id": "telegram-bot-credentials",
          "name": "Telegram Bot Credentials"
        }
      }
    },
    {
      "id": "calendar-validation-error",
      "name": "Calendar Validation Error",
      "type": "@n8n/n8n-nodes-base.telegram",
      "position": [600, 500],
      "parameters": {
        "operation": "sendMessage",
        "chatId": "={{ $('Telegram Bot').first().json.message.chat.id }}",
        "text": "‚ö†Ô∏è Calendar Command Error:\n\n{{ $('Parse Calendar Command').first().json.error }}\n\n{{ $('Parse Calendar Command').first().json.expectedFormat ? 'Format: ' + $('Parse Calendar Command').first().json.expectedFormat : '' }}"
      },
      "credentials": {
        "telegramApi": {
          "id": "telegram-bot-credentials",
          "name": "Telegram Bot Credentials"
        }
      }
    }
  ],
  "connections": {
    "Telegram Bot": {
      "main": [
        [
          {
            "node": "Parse Calendar Command",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Parse Calendar Command": {
      "main": [
        [
          {
            "node": "Google Calendar Create Event",
            "type": "main", 
            "index": 0,
            "conditions": {
              "type": "filter",
              "conditions": {
                "combinator": "and",
                "conditions": [
                  {
                    "leftValue": "={{ $json.authorized }}",
                    "rightValue": true,
                    "operator": {
                      "type": "boolean",
                      "operation": "equals"
                    }
                  },
                  {
                    "leftValue": "={{ $json.error }}",
                    "rightValue": "",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ]
              }
            }
          },
          {
            "node": "Calendar Validation Error",
            "type": "main",
            "index": 0,
            "conditions": {
              "type": "filter",
              "conditions": {
                "combinator": "or",
                "conditions": [
                  {
                    "leftValue": "={{ $json.authorized }}",
                    "rightValue": false,
                    "operator": {
                      "type": "boolean",
                      "operation": "equals"
                    }
                  },
                  {
                    "leftValue": "={{ $json.error }}",
                    "rightValue": "",
                    "operator": {
                      "type": "string",
                      "operation": "notEquals"
                    }
                  }
                ]
              }
            }
          }
        ]
      ]
    },
    "Google Calendar Create Event": {
      "main": [
        [
          {
            "node": "Calendar Success Reply",
            "type": "main",
            "index": 0
          }
        ]
      ],
      "error": [
        [
          {
            "node": "Calendar Error Reply",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "settings": {
    "executionOrder": "v1"
  },
  "staticData": {},
  "tags": [
    {
      "createdAt": "2025-07-07T07:33:00.000Z",
      "updatedAt": "2025-07-07T07:33:00.000Z",
      "id": "calendar-config",
      "name": "calendar-config"
    }
  ],
  "triggerCount": 1,
  "meta": {
    "templateCredsSetupCompleted": false
  },
  "id": "calendar-node-config",
  "versionId": "1"
}