<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DNS Analytics Widget QA Testing</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .qa-container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 8px;
            padding: 30px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .qa-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #e9ecef;
        }
        .qa-controls {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }
        .qa-btn {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.2s;
        }
        .qa-btn:hover {
            background-color: #0056b3;
        }
        .qa-btn.secondary {
            background-color: #6c757d;
        }
        .qa-btn.success {
            background-color: #28a745;
        }
        .qa-btn.danger {
            background-color: #dc3545;
        }
        .test-widget-demo {
            width: 100%;
            height: 500px;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            margin: 20px 0;
            background: #f8f9fa;
            position: relative;
        }
        .status-indicator {
            padding: 10px 15px;
            border-radius: 4px;
            margin: 10px 0;
            font-weight: bold;
        }
        .status-success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .status-error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .status-warning {
            background-color: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }
        .status-info {
            background-color: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        .qa-log {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            padding: 15px;
            margin: 20px 0;
            max-height: 300px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 12px;
        }
        .qa-progress {
            width: 100%;
            height: 20px;
            background-color: #e9ecef;
            border-radius: 10px;
            overflow: hidden;
            margin: 15px 0;
        }
        .qa-progress-bar {
            height: 100%;
            background-color: #007bff;
            width: 0%;
            transition: width 0.3s ease;
        }
        .test-metrics {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        .metric-card {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 6px;
            padding: 15px;
            text-align: center;
        }
        .metric-value {
            font-size: 24px;
            font-weight: bold;
            color: #007bff;
        }
        .metric-label {
            font-size: 12px;
            color: #6c757d;
            margin-top: 5px;
        }
    </style>
</head>
<body>
    <div class="qa-container">
        <div class="qa-header">
            <h1>üß™ DNS Analytics Widget QA Testing</h1>
            <p>Comprehensive Quality Assurance Testing for the DNS Analytics Dashboard Widget</p>
        </div>

        <div class="qa-controls">
            <button class="qa-btn" onclick="runFullTestSuite()">üöÄ Run Full Test Suite</button>
            <button class="qa-btn secondary" onclick="runIndividualTests()">üîç Individual Tests</button>
            <button class="qa-btn secondary" onclick="showTestLogs()">üìã View Test Logs</button>
            <button class="qa-btn success" onclick="initializeWidget()">üîß Initialize Widget</button>
            <button class="qa-btn danger" onclick="clearTestResults()">üóëÔ∏è Clear Results</button>
        </div>

        <div id="test-status" class="status-indicator status-info" style="display: none;">
            Ready to run tests...
        </div>

        <div class="qa-progress" id="test-progress" style="display: none;">
            <div class="qa-progress-bar" id="progress-bar"></div>
        </div>

        <div class="test-metrics" id="test-metrics" style="display: none;">
            <div class="metric-card">
                <div class="metric-value" id="metric-total">0</div>
                <div class="metric-label">Total Tests</div>
            </div>
            <div class="metric-card">
                <div class="metric-value" id="metric-passed">0</div>
                <div class="metric-label">Passed</div>
            </div>
            <div class="metric-card">
                <div class="metric-value" id="metric-failed">0</div>
                <div class="metric-label">Failed</div>
            </div>
            <div class="metric-card">
                <div class="metric-value" id="metric-score">0%</div>
                <div class="metric-label">Success Rate</div>
            </div>
        </div>

        <div class="test-widget-demo" id="dns-analytics-container">
            <div style="display: flex; align-items: center; justify-content: center; height: 100%; color: #6c757d;">
                <div style="text-align: center;">
                    <h3>DNS Analytics Widget Test Area</h3>
                    <p>Click "Initialize Widget" to load the DNS Analytics Widget for testing</p>
                </div>
            </div>
        </div>

        <div class="qa-log" id="test-log" style="display: none;">
            <strong>Test Log Output:</strong><br>
            <div id="log-content"></div>
        </div>

        <div id="test-report" style="display: none; margin-top: 20px;">
            <h3>Detailed Test Report</h3>
            <div id="report-content"></div>
        </div>
    </div>

    <!-- Load required dependencies -->
    <script>
        // Mock EventBus if not available
        if (!window.EventBus) {
            class EventBus {
                constructor() {
                    this.events = {};
                }
                on(event, callback) {
                    if (!this.events[event]) this.events[event] = [];
                    this.events[event].push(callback);
                }
                emit(event, data) {
                    if (this.events[event]) {
                        this.events[event].forEach(callback => callback(data));
                    }
                }
            }
            window.EventBus = EventBus;
            window.eventBus = new EventBus();
        }
    </script>

    <!-- Load DNS Analytics Widget -->
    <script src="widgets/dns-analytics/dns-analytics.js"></script>
    
    <!-- Load QA Test Suite -->
    <script src="test-dns-analytics-qa.js"></script>

    <script>
        let currentTestSuite = null;
        let widgetInstance = null;

        /**
         * Initialize DNS Analytics Widget
         */
        async function initializeWidget() {
            updateStatus('Initializing DNS Analytics Widget...', 'info');
            
            try {
                const container = document.getElementById('dns-analytics-container');
                container.innerHTML = ''; // Clear existing content
                
                // Create widget instance
                widgetInstance = new DnsAnalyticsWidget(container);
                
                // Wait for initialization
                await new Promise(resolve => setTimeout(resolve, 2000));
                
                updateStatus('DNS Analytics Widget initialized successfully!', 'success');
                logMessage('Widget initialized successfully');
                
            } catch (error) {
                updateStatus(`Failed to initialize widget: ${error.message}`, 'error');
                logMessage(`Widget initialization failed: ${error.message}`);
                console.error('Widget initialization error:', error);
            }
        }

        /**
         * Run complete test suite
         */
        async function runFullTestSuite() {
            updateStatus('Running comprehensive QA test suite...', 'info');
            showProgress(true);
            showMetrics(true);
            
            try {
                // Initialize test suite
                currentTestSuite = new DnsAnalyticsQATestSuite();
                
                // Run all tests
                const report = await currentTestSuite.runAllTests();
                
                // Update UI with results
                updateMetrics(report.summary);
                showTestReport(report);
                
                const status = report.summary.score >= 80 ? 'success' : 
                              report.summary.score >= 60 ? 'warning' : 'error';
                updateStatus(`Test suite completed! Score: ${report.summary.score}%`, status);
                
                logMessage(`Full test suite completed with score: ${report.summary.score}%`);
                
            } catch (error) {
                updateStatus(`Test suite failed: ${error.message}`, 'error');
                logMessage(`Test suite error: ${error.message}`);
                console.error('Test suite error:', error);
            } finally {
                showProgress(false);
            }
        }

        /**
         * Run individual tests
         */
        async function runIndividualTests() {
            updateStatus('Individual test mode not implemented yet', 'warning');
            logMessage('Individual test mode coming soon...');
        }

        /**
         * Show test logs
         */
        function showTestLogs() {
            const logElement = document.getElementById('test-log');
            logElement.style.display = logElement.style.display === 'none' ? 'block' : 'none';
        }

        /**
         * Clear test results
         */
        function clearTestResults() {
            document.getElementById('log-content').innerHTML = '';
            document.getElementById('test-report').style.display = 'none';
            document.getElementById('test-metrics').style.display = 'none';
            document.getElementById('test-log').style.display = 'none';
            updateStatus('Test results cleared', 'info');
        }

        /**
         * Update status indicator
         */
        function updateStatus(message, type) {
            const statusElement = document.getElementById('test-status');
            statusElement.textContent = message;
            statusElement.className = `status-indicator status-${type}`;
            statusElement.style.display = 'block';
        }

        /**
         * Show/hide progress bar
         */
        function showProgress(show) {
            const progressElement = document.getElementById('test-progress');
            progressElement.style.display = show ? 'block' : 'none';
            
            if (show) {
                // Simulate progress
                let progress = 0;
                const interval = setInterval(() => {
                    progress += Math.random() * 20;
                    if (progress >= 100) {
                        progress = 100;
                        clearInterval(interval);
                    }
                    document.getElementById('progress-bar').style.width = progress + '%';
                }, 500);
            }
        }

        /**
         * Show/hide metrics
         */
        function showMetrics(show) {
            const metricsElement = document.getElementById('test-metrics');
            metricsElement.style.display = show ? 'grid' : 'none';
        }

        /**
         * Update metrics display
         */
        function updateMetrics(summary) {
            document.getElementById('metric-total').textContent = summary.totalTests;
            document.getElementById('metric-passed').textContent = summary.passedTests;
            document.getElementById('metric-failed').textContent = summary.failedTests;
            document.getElementById('metric-score').textContent = summary.score + '%';
        }

        /**
         * Show test report
         */
        function showTestReport(report) {
            const reportElement = document.getElementById('test-report');
            const contentElement = document.getElementById('report-content');
            
            const reportHtml = `
                <div style="background: #f8f9fa; padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                    <h4>Test Summary</h4>
                    <p><strong>Total Tests:</strong> ${report.summary.totalTests}</p>
                    <p><strong>Passed:</strong> ${report.summary.passedTests} | <strong>Failed:</strong> ${report.summary.failedTests} | <strong>Warnings:</strong> ${report.summary.warningTests}</p>
                    <p><strong>Success Rate:</strong> ${report.summary.score}%</p>
                    <p><strong>Timestamp:</strong> ${new Date(report.summary.timestamp).toLocaleString()}</p>
                </div>
                
                <div>
                    <h4>Test Details</h4>
                    ${report.details.map(test => `
                        <div style="margin: 8px 0; padding: 8px; background: ${getStatusColor(test.status)}; border-radius: 4px; font-size: 14px;">
                            <strong>${test.test}:</strong> ${test.message}
                        </div>
                    `).join('')}
                </div>
                
                ${report.recommendations.length > 0 ? `
                    <div style="margin-top: 20px;">
                        <h4>Recommendations</h4>
                        ${report.recommendations.map(rec => `
                            <div style="margin: 10px 0; padding: 10px; background: #fff3cd; border-radius: 4px; border-left: 4px solid #ffc107;">
                                <strong>${rec.type.toUpperCase()}:</strong> ${rec.message}
                            </div>
                        `).join('')}
                    </div>
                ` : ''}
            `;
            
            contentElement.innerHTML = reportHtml;
            reportElement.style.display = 'block';
        }

        /**
         * Log message to test log
         */
        function logMessage(message) {
            const logContent = document.getElementById('log-content');
            const timestamp = new Date().toLocaleTimeString();
            logContent.innerHTML += `[${timestamp}] ${message}<br>`;
            logContent.scrollTop = logContent.scrollHeight;
        }

        /**
         * Get status color for test results
         */
        function getStatusColor(status) {
            const colors = {
                success: '#d4edda',
                error: '#f8d7da', 
                warning: '#fff3cd',
                info: '#d1ecf1'
            };
            return colors[status] || colors.info;
        }

        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            updateStatus('QA Testing Environment Ready', 'info');
            logMessage('DNS Analytics Widget QA Testing Environment initialized');
            
            // Auto-initialize widget for immediate testing
            setTimeout(() => {
                initializeWidget();
            }, 1000);
        });
    </script>
</body>
</html>